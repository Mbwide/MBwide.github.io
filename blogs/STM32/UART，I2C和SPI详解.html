<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>UART，I2C和SPI详解 | Mbwide</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="/logo.png">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="preload" href="/assets/css/0.styles.80fe8991.css" as="style"><link rel="preload" href="/assets/js/app.d6819784.js" as="script"><link rel="preload" href="/assets/js/3.ab2a4a31.js" as="script"><link rel="preload" href="/assets/js/1.e002bd7e.js" as="script"><link rel="preload" href="/assets/js/8.ea61ebc4.js" as="script"><link rel="prefetch" href="/assets/js/10.a93e005e.js"><link rel="prefetch" href="/assets/js/11.d890d360.js"><link rel="prefetch" href="/assets/js/12.bb8c599c.js"><link rel="prefetch" href="/assets/js/13.6127de58.js"><link rel="prefetch" href="/assets/js/14.90a4162c.js"><link rel="prefetch" href="/assets/js/15.91abec75.js"><link rel="prefetch" href="/assets/js/16.a692a777.js"><link rel="prefetch" href="/assets/js/17.8fa9b654.js"><link rel="prefetch" href="/assets/js/18.79d5b5f5.js"><link rel="prefetch" href="/assets/js/19.001f0625.js"><link rel="prefetch" href="/assets/js/20.c4430661.js"><link rel="prefetch" href="/assets/js/21.d4c8a516.js"><link rel="prefetch" href="/assets/js/22.fc3ce393.js"><link rel="prefetch" href="/assets/js/23.175526a1.js"><link rel="prefetch" href="/assets/js/4.d4e7d2ca.js"><link rel="prefetch" href="/assets/js/5.9308f3ce.js"><link rel="prefetch" href="/assets/js/6.b305968e.js"><link rel="prefetch" href="/assets/js/7.e084f12e.js"><link rel="prefetch" href="/assets/js/9.198fe034.js">
    <link rel="stylesheet" href="/assets/css/0.styles.80fe8991.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-2d5f533b><div data-v-2d5f533b><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-2d5f533b data-v-2d5f533b><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-2d5f533b data-v-2d5f533b><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>Mbwide</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>Mbwide</span>
            
          <span data-v-64685f0e>2020 - </span>
          2021
        </a></span></div></div> <div class="hide" data-v-2d5f533b><header class="navbar" data-v-2d5f533b><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Mbwide" class="logo"> <span class="site-name">Mbwide</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/C语言/" class="nav-link"><i class="iconfont undefined"></i>
  C语言
</a></li><li class="dropdown-item"><!----> <a href="/categories/C++/" class="nav-link"><i class="iconfont undefined"></i>
  C++
</a></li><li class="dropdown-item"><!----> <a href="/categories/STM32/" class="nav-link"><i class="iconfont undefined"></i>
  STM32
</a></li><li class="dropdown-item"><!----> <a href="/categories/数据结构与算法/" class="nav-link"><i class="iconfont undefined"></i>
  数据结构与算法
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div><div class="nav-item"><a href="/docs/" class="nav-link"><i class="iconfont reco-message"></i>
  关于我
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      连接
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Mbwide" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-2d5f533b></div> <aside class="sidebar" data-v-2d5f533b><div class="personal-info-wrapper" data-v-ca798c94 data-v-2d5f533b><img src="/avatar.png" alt="author-avatar" class="personal-img" data-v-ca798c94> <h3 class="name" data-v-ca798c94>
    Mbwide
  </h3> <div class="num" data-v-ca798c94><div data-v-ca798c94><h3 data-v-ca798c94>11</h3> <h6 data-v-ca798c94>文章</h6></div> <div data-v-ca798c94><h3 data-v-ca798c94>9</h3> <h6 data-v-ca798c94>标签</h6></div></div> <hr data-v-ca798c94></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/C语言/" class="nav-link"><i class="iconfont undefined"></i>
  C语言
</a></li><li class="dropdown-item"><!----> <a href="/categories/C++/" class="nav-link"><i class="iconfont undefined"></i>
  C++
</a></li><li class="dropdown-item"><!----> <a href="/categories/STM32/" class="nav-link"><i class="iconfont undefined"></i>
  STM32
</a></li><li class="dropdown-item"><!----> <a href="/categories/数据结构与算法/" class="nav-link"><i class="iconfont undefined"></i>
  数据结构与算法
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div><div class="nav-item"><a href="/docs/" class="nav-link"><i class="iconfont reco-message"></i>
  关于我
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      连接
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Mbwide" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-2d5f533b><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>UART，I2C和SPI详解</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>Mbwide</span>
            
          <span data-v-64685f0e>2020 - </span>
          2021
        </a></span></div></div> <div data-v-2d5f533b><main class="page"><div class="page-title" style="display:none;"><h1 class="title">UART，I2C和SPI详解</h1> <div data-v-3b7f5bdf><i class="iconfont reco-account" data-v-3b7f5bdf><span data-v-3b7f5bdf>Mbwide</span></i> <i class="iconfont reco-date" data-v-3b7f5bdf><span data-v-3b7f5bdf>2020-12-01</span></i> <!----> <i class="iconfont reco-tag tags" data-v-3b7f5bdf><span class="tag-item" data-v-3b7f5bdf>STM32</span><span class="tag-item" data-v-3b7f5bdf>通讯协议</span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><h1 id="uart-i2c和spi详解"><a href="#uart-i2c和spi详解" class="header-anchor">#</a> UART，I2C和SPI详解</h1> <table><thead><tr><th><strong>通信协议</strong></th> <th>UART</th> <th><strong>IIC</strong></th> <th><strong>SPI</strong></th></tr></thead> <tbody><tr><td><strong>信号线数目</strong></td> <td>RX（接收）、TX（发送）、GND</td> <td>SDA（数据线）、SCLK（时钟线）</td> <td>SDO（MOSI、主输出）、SDI（MISO、主输入）、SCLK、CS</td></tr> <tr><td><strong>设备从属关系</strong></td> <td>无</td> <td>存在，通过IIC发送地址信号选择从机</td> <td>存在，可通过片选信号线CS（低电平有效）选择从机</td></tr> <tr><td><strong>通信方式</strong></td> <td>全双工、异步</td> <td>半双工、同步</td> <td>全双工、同步</td></tr> <tr><td><strong>通信速率</strong></td> <td>串行IR接口最高支持115.2Kbit/S</td> <td>标准速度：100kbps；快速模式：400kbps；高速模式：3.4Mbps</td> <td>传输速率可达几Mbps水平甚至上百兆</td></tr></tbody></table> <h2 id="_1-uart"><a href="#_1-uart" class="header-anchor">#</a> 1 UART</h2> <blockquote><p><strong>UART：通用异步收发传输器（Universal Asynchronous Receiver/Transmitter）</strong></p></blockquote> <blockquote><p><strong>USART:通用同步异步收发器（Universal Synchronous Asynchronous Receiver and Transmitter）</strong></p></blockquote> <h3 id="_1-1-关键点"><a href="#_1-1-关键点" class="header-anchor">#</a> 1.1 关键点</h3> <ol><li><p><strong>它是用于控制计算机与串行设备的芯片。</strong></p></li> <li><p>UART由波特率产生器、UART接收器、UART发送器组成。</p></li> <li><p>由三条信号线组成：RX、TX、GND；其中RX和TX一般不加上拉电阻（加上可增强信号稳定性，也可默认下拉）。</p></li> <li><p>UART包括RS232、RS499、RS423、RS422和RS485等接口标准规范和总线标准规范。它们的主要区别在于其各自的电平范围不相同。 嵌入式设备中常常使用到的是TTL、TTL转RS232的这种方式。</p></li> <li><p>UART的功能计算机内部采用并行数据，不能直接把数据发到Modem，必须经过UART整理才能进行异步传输，其过程为：</p> <blockquote><p>CPU先把准备写入串行设备的数据放到UART的寄存器（临时内存块）中，再通过FIFO（First Input First Output，先入先出队列,一般接收用一个寄存器的8位，发送用一个寄存器的8位；有的是一个寄存器兼具发送和接收的功能，由相应标志位控制）传送到串行设备，若是没有FIFO，信息将变得杂乱无章，不可能传送到Modem。</p></blockquote></li></ol> <h3 id="_1-2-电平标准"><a href="#_1-2-电平标准" class="header-anchor">#</a> 1.2 电平标准</h3> <p>​	电平标准（<strong>电气特性，不涉及接插件、电缆或协议</strong>）</p> <ul><li><p>TTL：理想状态使用5V(一般大于2.4V都可以)，表示二进制逻辑1，0V表示逻辑0。</p></li> <li><p>RS232：RS-232使用-15V表示逻辑1，+15V表示逻辑0。传输速率一般不超过20Kbps</p></li> <li><p>RS-485：差分信号，逻辑“1”以两线间的电压差为+（2—6）V表示；逻辑“0”以两线间的电压差为-（2—6）V表示。数据最高传输速率为10Mbps 。</p> <p><img src="/assets/img/TTLandRS232.0ab6780e.png" alt="image-20201206202833743"></p></li></ul> <h3 id="_1-3-通讯协议"><a href="#_1-3-通讯协议" class="header-anchor">#</a> 1.3 通讯协议</h3> <p><img src="/assets/img/UART.9124a034.png" alt="image-20201206225228057"></p> <ul><li><p><strong>空闲位：</strong> 数据线在空闲状态的时候为**逻辑“1”**状态，也就是高电平，表示没有数据线空闲，
没有数据传输。</p></li> <li><p><strong>起始位：</strong> 当要传输数据的时候先传输一个<strong>逻辑“0”</strong>，也就是将数据线拉低，表示开始数据
传输。</p></li> <li><p><strong>数据位：</strong> 数据位就是实际要传输的数据，数据位数可选择 <strong>5~8 位</strong>，我们一般都是按照字节
传输数据的，一个字节 8 位，因此数据位<strong>通常是 8 位</strong>的。<strong>（小端传输）低位在前，高位在后</strong>。</p></li> <li><p><strong>奇偶校验位：</strong> 这是对数据中“1”的位数进行奇偶校验用的，可以不使用奇偶校验功能。</p></li> <li><p><strong>停止位：</strong> 数据传输完成标志位，停止位的位数可以选择1位、1.5位或2位高电平，一般都
选择1位停止位。</p></li> <li><p><strong>波特率：</strong> 波特率就是UART 数据传输的速率，也就是每秒传输的数据位数，一般选择 9600、
19200、115200 等。计算公式如下：
$$
boud = \frac{f}{16 * USARTDIV}\tag{1}
$$</p> <p>其中boud为波特率的值，f为USART时钟频率，USARTDIV是USART分频器除法因子
$$
USARTDIV = DIV_Mantissa + DIV_Fraction/16\tag{2}
$$
例如stm32，挂载在APB2总线的USART1，其有72MHz的时钟频率，即f=72MHz，假设我们需要115200的波特率，则由上面的公式可得：
$$
115200 = \frac{72000000}{16 * USARTDIV}\tag{3}
$$
我们能得到USARTDIV=39.0625，那么
$$
DIV_Mantissa=39=0x17\
DIV_Fraction=0.625*16=1=0x01\tag{4}
$$
这时我们应该设置USART_BRR的值为0x171。</p></li></ul> <h2 id="_2-i2c"><a href="#_2-i2c" class="header-anchor">#</a> 2 I2C</h2> <blockquote><p>I2C：两线式串行总线，也叫内部集成电路（Inter-Integrated Circuit）</p></blockquote> <p><img src="/assets/img/I2C1.85381d2c.png" alt="image-20201207192357228"></p> <h3 id="_2-1-关键点"><a href="#_2-1-关键点" class="header-anchor">#</a> 2.1 关键点</h3> <ol><li><p>串行、同步、半双工、低速率</p> <ul><li>串行：所有的数据<strong>以bit为单位</strong>在SDA线上串行传输（但每次传输8bit）。</li> <li>同步：即通信双方工作在同一个时钟。A方通过一根CLK信号线传输A的时钟给B，<strong>B工作在A传输的时钟下</strong>。</li></ul></li> <li><p>有两个接口，SCL和SDA。<strong>SDA和SCL都接上拉电阻（I2C的从设备本身是无法输出高电平,所以要接上拉），默认是空闲状态（高电平）</strong>；</p> <ul><li>SCL：时钟线，传输CLK信号，一般是I2C<strong>主设备向从设备提供时钟的通道</strong>。</li> <li>SDA：数据线，通信数据（命令、地址、数据）都通过SDA线传输。</li></ul></li> <li><p>主设备+从设备</p> <ul><li>分主设备和从设备。通信由主设备发起和主导，从设备只是按照<strong>I2C时序协议</strong>被动的接受主设备的通信。</li> <li>谁是主从设备，由通信双方来决定（I2C协议并无规定）。</li></ul></li> <li><p>可以多个设备挂在一条总线上（从设备地址）</p> <ul><li>主设备负责调度总线，决定某一时间和哪个从设备通信。</li> <li>同一时刻，只能有一个从设备和主设备通信，其他从设备处于“冬眠”状态。</li> <li>每个I2C从设备在通信中都有一个<strong>I2C从设备地址，共7个bit，广播地址全0。</strong></li> <li>它是从设备本身固有的属性。通信时主设备需要知道从设备的地址，然后在通信中通过地址来甄别是不是自己要找的那个从设备。这个地址是一个电路板上唯一的，不是全球唯一的。</li> <li>系统中可能有多个同种芯片，为此<strong>addr分为固定部分和可编程部份</strong>，细节视芯片而定，看datasheet。</li> <li>理论上7位有128位地址，然而除去保留几个保留地址如广播地址0x00等，数量少于128个，且标准协议里预见了地址的局限性，扩充了10位地址的概念。</li> <li>对于<strong>IIC可以挂多少个设备</strong>的问题：对于同一个地址的设备来说，在不进行地址扩充（片选）的情况下只能挂一个，对于不同的设备来说，标准协议里面没有限制具体的个数的多少，这个由线路布线情况，软件情况以及工作模式确定。对于标准模式，只要总线上的负载电容不超过400pf，不超过芯片的负载能力既可以。</li></ul></li> <li><p>SDA传输数据是<strong>大端传输（MSB），<strong>是</strong>以字节为单位</strong>的，每次传输的有效数据都是<strong>1个字节（8位）</strong>。</p></li> <li><p><strong>上拉电阻： 一方面是保护作用；另一方面增强驱动能力</strong></p></li></ol> <ul><li><p>I2C接口工作时只检测高、低电平，要是直接接电源的来实现高的话，一旦其他器件拉低时非常危险（<strong>保护</strong>）</p></li> <li><p>I2C总线是一种特殊的总线，因为多器件需共用总线，加上数据线需支持双向通信。SDA要求开漏输出模式。由于开漏无法直接输出“高（<strong>增强驱动能力</strong>）”时，需外加上拉电阻配合。</p></li></ul> <h3 id="_2-2-通讯协议"><a href="#_2-2-通讯协议" class="header-anchor">#</a> 2.2 通讯协议</h3> <p>​	<strong>完整的一帧I2C数据</strong></p> <p><img src="/assets/img/I2Cdata.941a7140.png" alt="img"></p> <ol><li><p><strong>数据有效性</strong></p> <p>​	  SDA线上数据必须在时钟的高电平周期保持稳定，数据线的高或低电平状态只有在 <strong>SCL线的时钟信号是低电平时才能改变</strong>。</p> <p><img src="/assets/img/I2C2.3e44bf9b.png" alt="image-20201207202037543"></p></li> <li><p><strong>起始信号和停止信号</strong></p> <ul><li><p>起始信号S：当SCL高电平时，SDA由高电平向低电平转换，是一种跳变信号，不是一个电平信号；</p></li> <li><p>停止信号P：当SCL高电平时，SDA由低电平向高电平转换，是一种跳变信号，不是一个电平信号。</p> <p><img src="/assets/img/I2C3.3233d380.png" alt="image-20201207203002972"></p></li></ul></li> <li><p><strong>响应ACK</strong></p> <p>数据接收方收到传输的一个字节数据后，需要给出响应，此时处在第九个时钟，发送端释放SDA线控制权，将SDA电平拉高，由接收方控制。</p> <ul><li>应答（ACK）：SDA为低电平</li> <li>非应答（ACK）：SDA为高电平</li></ul> <p><img src="/assets/img/I2CACK.c91ce302.png" alt="image-20201207203647736"></p></li> <li><p><strong>写时序</strong></p> <p><img src="/assets/img/I2Cwrite.ad2f8a95.png" alt="image-20201207204943104"></p> <ol><li><strong>开始</strong>信号。</li> <li>发送I2C设备地址，每个I2C器件都有一个<strong>设备地址</strong>，通过发送具体的设备地址来决定访问哪个I2C器件。这是一个8位的数据，其中<strong>高7位是设备地址，最后1位是读写位</strong>，为1的话表示这是一个读操作，为0的话表示这是一个写操作。</li> <li>I2C器件地址后面跟着一个读写位，0表示写，1表示读，发送<strong>写信号</strong>。</li> <li><strong>从机</strong>发送的ACK<strong>应答</strong>信号。</li> <li>重新发送<strong>开始</strong>信号。</li> <li>发送要写入数据的<strong>寄存器地址</strong>。</li> <li><strong>从机</strong>发送的ACK<strong>应答</strong>信号。</li> <li>发送要<strong>写</strong>入寄存器的<strong>数据</strong>。</li> <li><strong>从机</strong>发送的ACK<strong>应答</strong>信号。</li> <li><strong>停止</strong>信号。</li></ol></li> <li><p><strong>读时序</strong></p> <p><img src="/assets/img/I2Cread.c0c9507c.png" alt="image-20201207210138900"></p> <ol><li><strong>开始</strong>信号。</li> <li>主机发送要读取的 I2C <strong>从设备地址</strong>。</li> <li>读写控制位，因为是向 I2C 从设备发送数据，因此是<strong>写信号</strong>。</li> <li>从机发送的ACK <strong>应答</strong>信号。</li> <li>重新发送<strong>开始</strong>信号。</li> <li>主机发送要读取的<strong>寄存器地址</strong>。</li> <li><strong>从机</strong>发送的ACK<strong>应答</strong>信号。</li> <li>重新发送<strong>开始</strong>信号。</li> <li>重新发送要读取的 I2C<strong>从设备地址</strong>。</li> <li>读写控制位，这里是<strong>读信号</strong>，表示接下来是从 I2C 从设备里面读取数据。</li> <li>从机发送的ACK<strong>应答</strong>信号。</li> <li>从I2C器件里面<strong>读</strong>取到的<strong>数据</strong>。</li> <li>主机发出<strong>非应答</strong>（NO ACK）信号，表示读取完成，不需要从机再发送ACK信号了。</li> <li>主机发出<strong>停止</strong>信号，停止I2C通信。</li></ol></li> <li><p><strong>I2C多字节读写时序</strong></p> <p>有时候我们需要读写多个字节，多字节读写时序和单字节的基本一致，只是在读写数据的
时候可以连续发送多个自己的数据，其他的控制时序都是和单字节一样的。</p></li></ol> <h3 id="_2-3-其他要点"><a href="#_2-3-其他要点" class="header-anchor">#</a> 2.3 其他要点</h3> <ol><li><p>I2C地址分7位和10位。</p></li> <li><p>最直接的，牵涉到两方面的问题，首先是功耗的问题，其次是速度的问题，二者是矛盾的！如果你想尽量提高速度，那么就牵涉到总线电容的问题，其实很容易理解，上拉电阻与总线的电容形成了RC，高速时将直接影响通讯！因为总线拉高时有个充电时间以及高电平的阀值，如果还没有充电到足以保证从器件可以识别的高电平的阀值时主器件就以为完成了一个总线动作的话，那么通讯肯定是不能进行的！</p> <p>如果你想尽可能降低功耗，那么就要尽可能增大电阻以最大可能的减小电路各部分的消耗电流从而实现整体降低功耗！但不可能无限大</p></li></ol> <h2 id="_3-spi"><a href="#_3-spi" class="header-anchor">#</a> 3 SPI</h2> <blockquote><p>SPI：串行外设接口（Serial Peripheral Interface），是一种高速的，全双工，同步的通信总线。</p></blockquote> <p><img src="/assets/img/SPI1.0621e561.png" alt="image-20201207221233948"></p> <h3 id="_3-1-关键点"><a href="#_3-1-关键点" class="header-anchor">#</a> 3.1 关键点</h3> <ol><li>串行、同步、全双工、高速率
<ul><li>串行：协议支持字长<strong>不限于8bits</strong>，可根据应用特点灵活选择消息字长</li> <li>同步：即通信双方工作在同一个时钟。</li></ul></li> <li>最少需要4个接口，CS、SCLK、MOSI（SDO）和MISO（SDI）
<ul><li>CS/SS：Slave Select/Chip Select，这个是片选信号线，<strong>低电平有效</strong>。</li> <li>SCK：Serial Clock，串行时钟，该信号由主机产生，其支持的<strong>最高通讯速率为fpclk/2</strong>，即所挂载总线速率的一半。</li> <li>MOSI/SDO：Master Out Slave In/Serial Data Output，简称主出从入信号线，这根数据线
只能用于主机向从机发送数据，也就是主机输出，从机输入。</li> <li>MISO/SDI：Master In Slave Out/Serial Data Input，简称主入从出信号线，这根数据线只
能用户从机向主机发送数据，也就是主机输入，从机输出。</li></ul></li> <li>没有指定的流控制，没有应答机制确认是否接收到数据，所以跟IIC总线协议比较在数据
可靠性上有一定的缺陷。</li> <li>没有寻址机制，只能靠片选选择不同设备；</li></ol> <h3 id="_3-2-通讯协议"><a href="#_3-2-通讯协议" class="header-anchor">#</a> 3.2 通讯协议</h3> <ol><li><p><strong>起始，停止信号</strong></p> <ul><li><p>CS/SS电平由高变低，则产生起始信号；</p></li> <li><p>CS/SS电平由低变高，则产生停止信号。</p></li></ul></li> <li><p><strong>数据有效性</strong></p> <ul><li>MOSI和MISO线在SCK的每个时钟周期传输一位数据，开发者可以<strong>自行设置MSB或LSB先行</strong>，不过需要保证两个通讯设备都使用同样的协定。</li> <li>SPI 有四种工作模式，通过串行时钟极性(CPOL)和相位(CPHA)的搭配来得到四种工作模式</li></ul></li> <li><p><strong>四种工作模式</strong></p> <p>SPI 有四种工作模式，通过串行时钟极性(CPOL)和相位(CPHA)的搭配来得到四种工作模式：</p></li></ol> <ul><li><p>**CPOL：**即在没有数据传输时，时钟的空闲状态的电平。</p> <ul><li>**CPHA：**即数据的采样时刻。</li></ul> <p><img src="/assets/img/SPI2.8493e7c9.png" alt="image-20201207223945909"></p> <table><thead><tr><th style="text-align:center;">SPI模式</th> <th>CPOL</th> <th>CPHA</th> <th>空闲时SCK时钟</th> <th>采样时间</th></tr></thead> <tbody><tr><td style="text-align:center;">0</td> <td>1</td> <td>1</td> <td>高电平</td> <td>第二个边沿（偶）</td></tr> <tr><td style="text-align:center;">1</td> <td>1</td> <td>0</td> <td>高电平</td> <td>第一个边沿（奇）</td></tr> <tr><td style="text-align:center;">2</td> <td>0</td> <td>1</td> <td>低电平</td> <td>第二个边沿（偶）</td></tr> <tr><td style="text-align:center;">3</td> <td>0</td> <td>0</td> <td>低电平</td> <td>第一个边沿（奇）</td></tr></tbody></table></li></ul></div> <footer class="page-edit" style="display:none;"><!----> <!----></footer> <!----> <!----> <!----></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.d6819784.js" defer></script><script src="/assets/js/3.ab2a4a31.js" defer></script><script src="/assets/js/1.e002bd7e.js" defer></script><script src="/assets/js/8.ea61ebc4.js" defer></script>
  </body>
</html>
